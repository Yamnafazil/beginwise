<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeginWise - School Finder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/nav.css" />
</head>

<body>
    <nav class="navbar navbar-expand-lg fixed-top" id="nav" style="margin-bottom:3px;">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                <img src="assets/img/logo.svg" alt="beginwise" id="logo" width="180px" height="51px">
            </a>

            <span class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#navoffcanvas"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"
                style="border: none;">
                <i class="fa-solid fa-bars" style="color: #EF923E; font-size: 20px;"></i>
            </span>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto  mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link li-item" aria-current="page" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link li-item" aria-current="page" href="schoolfinder.html">School Finder</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link li-item" aria-current="page" href="prephub.html">PrepHub</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link li-item" aria-current="page" href="about.html">About Us</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link li-item" aria-current="page" href="#">Contact Us</a>
                    </li>

                    <!-- Static version for logged-out state -->
                    <li class="nav-item" id="signupLink">
                        <a class="nav-link li-item" href="signup.html">Sign Up</a>
                    </li>
                    <li class="nav-item" id="loginLink">
                        <a class="nav-link li-item" href="login.html">Login</a>
                    </li>

                    <!-- Static version for logged-in state -->
                    <li class="nav-item dropdown profile mb-0 pt-0" id="userDropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="profileDropdown">
                            <img src="assets/img/profile.png" alt="Profile Image" class="rounded-circle profile"
                                width="40" height="40" style="position:relative; top:-10px;">
                        </a>
                        <ul class="dropdown-menu custom-dropdown" aria-labelledby="profileDropdown">
                            <li><a class="dropdown-item" href="profile.html" id="usernameDisplay">User Name</a></li>
                            <li><a class="dropdown-item" href="child_detail_form.html">Add Child Details</a></li>
                            <li><a class="dropdown-item" href="child_detail_show.html">Show Child Details</a></li>
                            <li><a class="dropdown-item" onclick="logout()">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Off-canvas for collapse -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="navoffcanvas" aria-labelledby="offcanvasRightLabel">
        <div class="offcanvas-header">
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"
                style="position:absolute;top:30px; right:30px;"></button>
        </div>
        <div class="offcanvas-body">
            <div>
                <ul class="list-unstyled list-group list-group-flush pb-5 pt-5" id="offcanvasnav">
                    <li class="list-group-item">
                        <a class="offcanvasnavlink" aria-current="page" href="schoolfinder.html">School Finder</a>
                    </li>
                    <li class="list-group-item">
                        <a class="offcanvasnavlink" aria-current="page" href="prephub.html">PrepHub</a>
                    </li>
                    <li class="list-group-item">
                        <a class="offcanvasnavlink" aria-current="page" href="about.html">About Us</a>
                    </li>
                    <li class="list-group-item">
                        <a class="offcanvasnavlink" aria-current="page" href="#">Contact Us</a>
                    </li>

                    <li class="list-group-item" id="signupLinkSmall">
                        <a class="offcanvasnavlink" aria-current="page" href="signup.html">Sign up</a>
                    </li>
                    <li class="list-group-item" id="loginLinkSmall">
                        <a class="offcanvasnavlink" aria-current="page" href="login.html">Login</a>
                    </li>


                    <!-- Static version for logged-in state -->
                    <li class="nav-item dropdown profile mb-0 pt-0" id="userDropdownSmall">
                        <a class="nav-link dropdown-toggle" href="#" id="profileDropdownSmall">
                            <img src="assets/img/profile.png" alt="Profile Image" class="rounded-circle" width="40"
                                height="40" style="position:relative; top:-10px;">
                        </a>
                        <ul class="dropdown-menu custom-dropdown" aria-labelledby="profileDropdown"
                            style="position:absolute;right:150px;">
                            <li><a class="dropdown-item" href="profile.html" id="usernameDisplaySmall">User Name</a>
                            </li>
                            <li><a class="dropdown-item" href="child_detail_form.html">Add Child Details</a></li>
                            <li><a class="dropdown-item" href="child_detail_show.html">Show Child Details</a></li>
                            <li><a class="dropdown-item" onclick="logout()">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Check if a user is logged in
        document.addEventListener("DOMContentLoaded", () => {
            const user = JSON.parse(localStorage.getItem('user'));

            const signupLink = document.getElementById('signupLink');
            const loginLink = document.getElementById('loginLink');
            const userDropdown = document.getElementById('userDropdown');
            const usernameDisplay = document.getElementById('usernameDisplay');

            const signupLinkSmall = document.getElementById('signupLinkSmall');
            const loginLinkSmall = document.getElementById('loginLinkSmall');
            const userDropdownSmall = document.getElementById('userDropdownSmall');
            const usernameDisplaySmall = document.getElementById('usernameDisplaySmall');

            if (user) {
                // User is logged in
                signupLink.style.display = 'none';
                signupLinkSmall.style.display = 'none';
                loginLink.style.display = 'none';
                loginLinkSmall.style.display = 'none';
                userDropdown.style.display = 'block';
                usernameDisplay.textContent = user.username;
                usernameDisplaySmall.textContent = user.username;
            } else {
                // No user logged in
                signupLink.style.display = 'block';
                signupLinkSmall.style.display = 'block';
                loginLink.style.display = 'block';
                loginLinkSmall.style.display = 'block';
                userDropdown.style.display = 'none';
                userDropdownSmall.style.display = 'none';
            }
        });

        // Logout function
        function logout() {
            localStorage.removeItem('user'); // Remove user from localStorage
            alert('Logout Successfully');
            window.location.href = 'index.html';
        }
    </script>
    <div class="container mt-5" style="padding-top: 130px;">
        <h1 style="color: #EF923E; font-size: 1.9rem; text-align: center;">Discover Your Ideal School</h1>
        <p style="text-align: center;">Get personalized recommendations based on your location and board preferences.</p>

        <!-- Location options -->
        <div class="mb-3">
            <label style="color: #EF923E; font-size: 1.9rem;" for="locationSelect">Select Addresses (max 3):</label>
            <select id="locationSelect" class="form-select" aria-label="Select Addresses">
                <option value="">Select Locations</option>
                <!-- Options will be populated here -->
            </select>
        </div>
        <div id="selectedAddresses" class="mb-3">
            <!-- Selected addresses will be shown here as buttons -->
        </div>

        <!-- Board options -->
        <div class="mb-3" id="boardOptions">
            <label style="color: #EF923E; font-size: 1.9rem;">Education Boards (max 2):</label>
            <!-- Board checkboxes will be populated here -->
        </div>

        <!-- Fee range -->
        <div class="mb-3">
            <label for="fee_range" class="form-label" style="color: #EF923E; font-size: 1.9rem;">Fee Range</label>
            <select id="fee_range" class="form-control" required>
                <option value="">Select Fee Range</option>
                <!-- Fee options will be populated here -->
            </select>
        </div>

        <button style="background-color: #EF923E; border: none;" class="btn btn-primary mb-3" onclick="submitForm()">Get Recommendations</button>
        <div class="results-container row">
            <!-- Existing results might go here, or this could just be an empty container to start -->
          </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>

var totalAddresses = 0;
var totalBoards = 0; 
        
        document.addEventListener('DOMContentLoaded', function () {
            fetch('http://localhost:5000/api/school/addresses').then(response => response.json()).then(data => {
                const select = document.getElementById('locationSelect');
                data.forEach(address => {
                    const option = document.createElement('option');
                    option.value = address;
                    option.textContent = address;
                    select.appendChild(option);
                });
            });

            fetch('http://localhost:5000/api/school/boards')
    .then(response => response.json())
    .then(data => {
        const container = document.getElementById('boardOptions');
        data.forEach(board => {
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = board.replace(/\s+/g, '-');
            checkbox.name = 'boards[]';
            checkbox.value = board;

            const label = document.createElement('label');
            label.htmlFor = checkbox.id;
            label.textContent = board;
            label.style = 'padding-left: 10px; width: 100%;'
            label.insertBefore(checkbox, label.firstChild);

            container.appendChild(label);
        });

        // Add event listeners to each checkbox after they have been appended to the container
        addCheckboxListeners();
    });

function addCheckboxListeners() {
    const checkboxes = document.querySelectorAll('input[name="boards[]"]');
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const checkedBoxes = document.querySelectorAll('input[name="boards[]"]:checked');
            if (checkedBoxes.length > 2) {
                alert('You can select up to 2 boards only.');
                this.checked = false; // Uncheck this box
            }
        });
    });
}

            fetch('http://localhost:5000/api/school/fees').then(response => response.json()).then(data => {
                const feeSelect = document.getElementById('fee_range');
                data.forEach(fee => {
                    const option = document.createElement('option');
                    option.value = fee;
                    option.textContent = fee;
                    feeSelect.appendChild(option);
                });
            });

            const locationSelect = document.getElementById('locationSelect');
            locationSelect.addEventListener('change', function () {
                const selectedContainer = document.getElementById('selectedAddresses');
                updateSelectedAddresses(selectedContainer, this);
            });
            

            function updateSelectedAddresses(container, select) {


                if (totalAddresses <= 2) {
                    Array.from(select.selectedOptions).forEach(option => {
                        const btn = document.createElement('button');
                        btn.className = 'btn btn-info m-1';
                        btn.style = 'background: #EF923E; border: none; color: white;'
                        btn.textContent = option.text;
                       
                        container.appendChild(btn);
                    });
                    totalAddresses += 1;
                    console.log(totalAddresses);
                    
                } else {
                    alert('You can select maximum 3 addresses!')
                }
            }

            document.querySelectorAll('input[name="boards[]"]').forEach(input => {
                input.addEventListener('change', function () {
                    const checkedBoxes = document.querySelectorAll('input[name="boards[]"]:checked');
                    if (checkedBoxes.length > 2) {
                        alert('You can select up to 2 boards only.');
                        input.checked = false;
                    }
                });
            });

            document.getElementById('fee_range').addEventListener('change', function () {
                if (!this.value) {
                    alert('You must select a fee range.');
                }
            });
        });

        function submitForm() {
            const selectedAddresses = Array.from(document.querySelectorAll('#selectedAddresses button')).map(btn => btn.textContent);
            const selectedBoards = Array.from(document.querySelectorAll('input[name="boards[]"]:checked')).map(cb => cb.value);
            const selectedFee = document.getElementById('fee_range').value;

            if (!selectedFee || selectedBoards.length < 1 || selectedAddresses.length < 1) {
                alert('Please ensure you have selected at least one address, one board, and a fee range.');
                return;
            }

            

            const formData = {
                Addresses: selectedAddresses,
                Boards: selectedBoards,
                FeeRange: selectedFee
            };

            fetch('http://localhost:5000/api/school/search-schools', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        addresses: selectedAddresses,
        fees: selectedFee,
        boards: selectedBoards
    })
    
})
.then(response => {
    // Check if the response is okay (status in the range 200-299)
    if (!response.ok) {
        // If the server responds with a 404 status, we assume no schools were found
        if (response.status === 404) {
            alert('No schools found matching your criteria.');
        } else {
            // For all other non-ok responses, throw an error to be caught by the catch block
            throw new Error('Network response was not ok.');
        }
        return []; // Return an empty array to prevent further processing in the next .then block
    }
    return response.json(); // Parse JSON data from the response if it was ok
})
.then(data => {
    // Data is an empty array if the response was not ok or contained no data
    if (data.length === 0) {
        // Optionally handle the no data state in the UI, if not already handled via alert
        console.log('No results to display.');
        // For example, update the UI to clear any existing results:
        // document.getElementById('results').innerHTML = 'No schools found.';
    } else {
        // Call a function to process and display the data if schools were found
        displayResults(data);
    }
})
.catch(error => {
    // Handle errors that occurred during fetch or processing the response
    console.error('Error:', error);
    alert('Failed to load data. Please try again.');
});


function displayResults(schools) {
    const resultsContainer = document.querySelector('.results-container');
    resultsContainer.innerHTML = ''; // Clear existing content

    // Filter and limit schools based on matchedAttributes
    const matched3 = schools.filter(school => school.matched === 3);
    const matched2 = schools.filter(school => school.matched === 2).slice(0, 5);
    const matched1 = schools.filter(school => school.matched === 1).slice(0, 3);

    // Combine all filtered schools in the right order
    const sortedAndFilteredSchools = [...matched3, ...matched2, ...matched1];

    sortedAndFilteredSchools.forEach(school => {
        const schoolDiv = document.createElement('div');
        schoolDiv.className = 'col-md-4';
        schoolDiv.innerHTML = `
            <div class="card mb-3 schoolCard" style="border: solid #EF923E 2px; padding: 10px;">
                <h5 class="card-title" style="font-size: 2rem;">${school.name}</h5>
                <p class="card-text"><b>Matched Attributes: </b>${school.matchedAttributes}</p>
                <p class="card-text"><b>Address: </b>${school.address}</p>
                <p class="card-text"><b>Board: </b>${school.board}</p>
                <p class="card-text"><b>Fee Range: </b>${school.fees}</p>
                <p class="card-text"><b>Website: </b>${school.website || 'Not Available'}</p>
                <p class="card-text"><b>Contact: </b>${school.contact || 'Contact information not available'}</p>
                <p><b>Match Percentage:</b></p>
                <div style="width: 100%; border-radius: 5px; background: #ccc; position: relative;">
                    <div style="height: 100%; width: ${Math.round(100 / 3 * Number(school.matched))}%; background: #EF923E; border-radius: 5px; position: absolute;"></div>
                    <p style="margin: 0; padding-inline: 10px; z-index: 10; position: relative;">${Math.round(100 / 3 * Number(school.matched))}%</p>
                </div>
            </div>
        `;
        resultsContainer.appendChild(schoolDiv);
    });
}



totalAddresses = 0;
            document.getElementById('selectedAddresses').innerHTML = '';
            selectedAddresses = [];


        }
    </script>


<footer class="text-center text-lg-start bg-body-tertiary">

    <!-- Section: Links -->
    <section class="pt-5">
        <hr style="width: 100%; color: #EF923E;">
        <div class="container text-center text-md-start p-0" id="fc">

            <!-- Grid row -->
            <div class="row mt-3">
                <!-- Grid column -->
                <div class="col-md-4 col-lg-3 col-xl-3 ps-0">
                    <!-- Content -->
                    <img src="assets/img/beginwiseLogo.svg" alt="" height="300px" width="300px" id="fimg"
                        class="mb-4 mt-0">
                </div>

                <!-- Grid column -->
                <div class="col-md-3 col-lg-2 col-xl-2 mx-auto mb-4">
                    <!-- Links -->
                    <h6 class="text-uppercase fw-bold mt-5 pt-4" style="color:#EF923E">
                        Useful links
                    </h6>
                    <p>
                        <a href="schoolfinder.html" class="text-reset fl">School Finder</a>
                    </p>
                    <p>
                        <a href="prephub.html" class="text-reset fl">Prephub</a>
                    </p>
                    <p>
                        <a href="about.html" class="text-reset fl">About Us</a>
                    </p>

                    <p>
                        <a href="#!" class="text-reset fl">Contact Us</a>
                    </p>

                </div>
                <!-- Grid column -->
                <!-- Grid column -->
                <div class="col-md-4 col-lg-5 col-xl-3 mx-auto mb-md-0 mb-4">
                    <!-- Links -->
                    <h6 class="text-uppercase fw-bold mt-5 pt-4" style="color:#EF923E">Contact</h6>
                    <a href="mailto:beginwise61@gmail.com" class="fl" target="_blank">
                        <p style="color: black;">
                            <i class="fas fa-envelope me-3" style="color:#EF923E"></i>
                            info@example.com
                        </p>
                    </a>
                    <a href="tel:03002468949" class="fl" target="_blank">
                        <p style="color: black;"><i class="fas fa-phone me-3" style="color:#EF923E"></i> 03002468949
                        </p>
                    </a>
                    <a href="https://www.facebook.com/beginwise" class="fl" target="_blank">
                        <p style="color: black;"><i class="fa-brands fa-square-facebook"
                                style="color:#EF923E; font-size: 20px;"></i>&nbsp;&nbsp;&nbsp; Begin Wise</p>
                    </a>
                    <a href="https://www.instagram.com/begin_wise?igsh=NDJrMGRnb296cXZ0" class="fl" target="_blank">
                        <p style="color: black;"><i class="fa-brands fa-square-instagram"
                                style="color:#EF923E; font-size: 20px;"></i>&nbsp;&nbsp;&nbsp; begin_wise</p>
                    </a>
                </div>
                <!-- Grid column -->
            </div>
            <!-- Grid row -->
        </div>
    </section>
    <!-- Section: Links -->
    <!-- Copyright -->
    <div class="text-center text-light p-4" style="background-color:#EF923E">
        &copy; 2024 Copyright:
        <a class="text-reset fw-bold" href="Recommendation.html">BeginWise</a>
    </div>
    <!-- Copyright -->
</footer>
<!-- Footer -->
<!-- Chat Toggle Button -->
<button id="chat-toggle">💬</button>

<!-- Chat Window -->
<div id="chat-window">
    <div id="chat-header">Beginwise Chatbot</div>
    <div id="chat-body">
        <div class="message bot-message">Chatbot: Hi! Ask me anything about Beginwise. Type 'exit' or 'quit' to end
            the chat.</div>
    </div>
    <div id="question-recommendations">
        <!-- Recommended Questions -->
        <span class="recommended-question">What is Beginwise?</span>
        <span class="recommended-question">How can Beginwise help my child's education?</span>
        <span class="recommended-question">What age groups does Beginwise cater to?</span>
        <span class="recommended-question">Tell me about the School Recommendation feature.</span>
        <span class="recommended-question">How does the Parental Interview Preparation work?</span>
    </div>
    <div id="chat-footer">
        <input type="text" id="chat-input" placeholder="Type your message..." />
        <button id="send-button">Send</button>
    </div>
</div>

<!-- JavaScript -->
<script>
    // Responses similar to the Python version
    const responses = {
        "what is beginwise": "Beginwise is an educational platform designed to provide young learners with engaging and interactive learning experiences. It offers tools like school recommendations, admission test preparation, and fun learning games, tailored for children aged 1 to 8.",
        "how can beginwise help my child's education": "Beginwise helps your child by offering personalized learning modules, interactive quizzes, and hands-on worksheets that make learning fun and effective.",
        "what age groups does beginwise cater to": "Beginwise caters to children aged 1 to 6, covering the educational needs of students from Playgroup to Grade 1.",
        "tell me about the school recommendation feature": "The School Recommendation feature helps parents find the best schools for their children based on factors such as location, board, and fee structure, making the school selection process easier.",
        "how does the parental interview preparation work": "Our Parental Interview Preparation module offers guidance and practice questions to help parents prepare for school admission interviews, building confidence and ensuring you are well-prepared.",
        // Add other questions and responses here...
        "default": "I'm not sure how to respond to that. Can you please provide more details?"
    };

    // Chat toggle functionality
    const chatToggle = document.getElementById('chat-toggle');
    const chatWindow = document.getElementById('chat-window');
    chatToggle.addEventListener('click', () => {
        chatWindow.style.display = chatWindow.style.display === 'none' || chatWindow.style.display === '' ? 'flex' : 'none';
    });

    // Chatbot logic
    const chatInput = document.getElementById('chat-input');
    const chatBody = document.getElementById('chat-body');
    const sendButton = document.getElementById('send-button');
    const recommendedQuestions = document.querySelectorAll('.recommended-question');

    function getResponse(message) {
        const lowerMessage = message.toLowerCase();
        for (const key in responses) {
            if (lowerMessage.includes(key)) {
                return responses[key];
            }
        }
        return responses['default'];
    }

    function appendMessage(content, isUser) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message', isUser ? 'user-message' : 'bot-message');
        messageDiv.textContent = content;
        chatBody.appendChild(messageDiv);
        chatBody.scrollTop = chatBody.scrollHeight;  // Scroll to the bottom
    }

    function handleUserInput() {
        const userMessage = chatInput.value.trim();
        if (userMessage) {
            appendMessage(`You: ${userMessage}`, true);
            const botResponse = getResponse(userMessage);
            appendMessage(`Chatbot: ${botResponse}`, false);
            chatInput.value = '';  // Clear input field
        }
    }

    sendButton.addEventListener('click', handleUserInput);

    chatInput.addEventListener('keydown', (event) => {
        if (event.key === 'Enter') {
            handleUserInput();
        }
    });

    // Handle recommended questions click
    recommendedQuestions.forEach(question => {
        question.addEventListener('click', () => {
            chatInput.value = question.textContent;
            chatInput.focus();  // Set focus to the input field
        });
    });
</script>

<style>
    .schoolCard {
        transition: 0.1s ease-in-out;
        min-height: 450px;
    }
    .schoolCard:hover {
        transform: scale(1.01);
    }
</style>

</body>

</html>