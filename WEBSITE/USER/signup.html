<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="">
    <title>BeginWise - Sign Up</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
    <link rel="stylesheet" href="assets/css/nav.css" />
    <link rel="stylesheet" href="assets/css/index.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg fixed-top" id="nav" style="margin-bottom:3px;">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                <img src="assets/img/logo.svg" alt="beginwise" id="logo" width="180px" height="51px">
            </a>

            <span class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#navoffcanvas"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"
                style="border: none;">
                <i class="fa-solid fa-bars" style="color: #EF923E; font-size: 20px;"></i>
            </span>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto  mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link li-item" aria-current="page" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link li-item" aria-current="page" href="schoolfinder.html">School Finder</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link li-item" aria-current="page" href="prephub.html">PrepHub</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link li-item" aria-current="page" href="about.html">About Us</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link li-item" aria-current="page" href="#">Contact Us</a>
                    </li>

                    <!-- Static version for logged-out state -->
                    <li class="nav-item" id="signupLink">
                        <a class="nav-link li-item" href="signup.html">Sign Up</a>
                    </li>
                    <li class="nav-item" id="loginLink">
                        <a class="nav-link li-item" href="login.html">Login</a>
                    </li>

                    <!-- Static version for logged-in state -->
                    <li class="nav-item dropdown profile mb-0 pt-0" id="userDropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="profileDropdown">
                            <img src="assets/img/profile.png" alt="Profile Image" class="rounded-circle profile"
                                width="40" height="40" style="position:relative; top:-10px;">
                        </a>
                        <ul class="dropdown-menu custom-dropdown" aria-labelledby="profileDropdown">
                            <li><a class="dropdown-item" href="profile.html" id="usernameDisplay">User Name</a></li>
                            <li><a class="dropdown-item" href="child_detail_form.html">Add Child Details</a></li>
                            <li><a class="dropdown-item" href="child_detail_show.html">Show Child Details</a></li>
                            <li><a class="dropdown-item" onclick="logout()">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Off-canvas for collapse -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="navoffcanvas" aria-labelledby="offcanvasRightLabel">
        <div class="offcanvas-header">
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"
                style="position:absolute;top:30px; right:30px;"></button>
        </div>
        <div class="offcanvas-body">
            <div>
                <ul class="list-unstyled list-group list-group-flush pb-5 pt-5" id="offcanvasnav">
                    <li class="list-group-item">
                        <a class="offcanvasnavlink" aria-current="page" href="schoolfinder.html">School Finder</a>
                    </li>
                    <li class="list-group-item">
                        <a class="offcanvasnavlink" aria-current="page" href="prephub.html">PrepHub</a>
                    </li>
                    <li class="list-group-item">
                        <a class="offcanvasnavlink" aria-current="page" href="about.html">About Us</a>
                    </li>
                    <li class="list-group-item">
                        <a class="offcanvasnavlink" aria-current="page" href="#">Contact Us</a>
                    </li>

                    <li class="list-group-item" id="signupLinkSmall">
                        <a class="offcanvasnavlink" aria-current="page" href="signup.html">Sign up</a>
                    </li>
                    <li class="list-group-item" id="loginLinkSmall">
                        <a class="offcanvasnavlink" aria-current="page" href="login.html">Login</a>
                    </li>


                    <!-- Static version for logged-in state -->
                    <li class="nav-item dropdown profile mb-0 pt-0" id="userDropdownSmall">
                        <a class="nav-link dropdown-toggle" href="#" id="profileDropdownSmall">
                            <img src="assets/img/profile.png" alt="Profile Image" class="rounded-circle" width="40"
                                height="40" style="position:relative; top:-10px;">
                        </a>
                        <ul class="dropdown-menu custom-dropdown" aria-labelledby="profileDropdown"
                            style="position:absolute;right:150px;">
                            <li><a class="dropdown-item" href="profile.html" id="usernameDisplaySmall">User Name</a>
                            </li>
                            <li><a class="dropdown-item" href="child_detail_form.html">Add Child Details</a></li>
                            <li><a class="dropdown-item" href="child_detail_show.html">Show Child Details</a></li>
                            <li><a class="dropdown-item" onclick="logout()">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Check if a user is logged in
        document.addEventListener("DOMContentLoaded", () => {
            const user = JSON.parse(localStorage.getItem('user'));

            const signupLink = document.getElementById('signupLink');
            const loginLink = document.getElementById('loginLink');
            const userDropdown = document.getElementById('userDropdown');
            const usernameDisplay = document.getElementById('usernameDisplay');

            const signupLinkSmall = document.getElementById('signupLinkSmall');
            const loginLinkSmall = document.getElementById('loginLinkSmall');
            const userDropdownSmall = document.getElementById('userDropdownSmall');
            const usernameDisplaySmall = document.getElementById('usernameDisplaySmall');

            if (user) {
                // User is logged in
                signupLink.style.display = 'none';
                signupLinkSmall.style.display = 'none';
                loginLink.style.display = 'none';
                loginLinkSmall.style.display = 'none';
                userDropdown.style.display = 'block';
                usernameDisplay.textContent = user.username;
                usernameDisplaySmall.textContent = user.username;
            } else {
                // No user logged in
                signupLink.style.display = 'block';
                signupLinkSmall.style.display = 'block';
                loginLink.style.display = 'block';
                loginLinkSmall.style.display = 'block';
                userDropdown.style.display = 'none';
                userDropdownSmall.style.display = 'none';
            }
        });

        // Logout function
        function logout() {
            localStorage.removeItem('user'); // Remove user from localStorage
            alert('Logout Successfully');
            window.location.href = 'index.html';
        }
    </script>
    <div style="height:90px" width="1005"></div>

    <section id="signup" class="st-shape-wrap st-white-bg section-padding mt-5">
        <div class="container">
            <div class="st-section-heading st-style1 text-center">
                <h2 class="st-section-heading-title" style="color: orange;">Sign Up</h2>
                <p class="st-section-heading-subtitle">Join us and get access to the best educational resources and
                    personalized recommendations for your academic journey.</p>
            </div>
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <form id="signupForm">
                        <div id="st-alert1"></div>
                        <div class="mb-3">
                            <label for="name" class="form-label"><i style="color: orange;" class="fas fa-user icon"></i>
                                Username</label>
                            <input type="text" class="form-control" name="name" id="name" placeholder="Enter Username"
                                required>
                            <div id="nameError" class="error"></div>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label"><i style="color: orange;"
                                    class="fas fa-lock icon"></i> Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control" name="pswd" id="password"
                                    placeholder="Enter Password" required>
                                <span class="input-group-text toggle-password" onclick="togglePasswordVisibility()">
                                    <i class="fas fa-eye" id="togglePasswordIcon"></i>
                                </span>
                            </div>
                            <div id="passwordError" class="error"></div>
                        </div>
                        <div class="mb-3">
                            <label for="contact" class="form-label"><i style="color: orange;"
                                    class="fas fa-phone icon"></i> Contact</label>
                            <input type="text" class="form-control" name="con" id="contact"
                                placeholder="Enter Contact No" required>
                            <div id="contactError" class="error"></div>
                        </div>
                        <button style="background-color: orange; color:  white; transition: 0.2s ease;" type="button"
                            class="btn btn-custom w-100 my-button" onclick="handleSignup()">Sign Up</button>
                        <style>
                            .my-button:hover {
                                background-color: rgb(158, 105, 6);
                            }
                        </style>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <script>
        async function handleSignup() {
            const user_name = document.getElementById('name').value.trim();
            const user_password = document.getElementById('password').value.trim();
            const user_contact = document.getElementById('contact').value.trim();

            document.getElementById('nameError').textContent = "";
            document.getElementById('passwordError').textContent = "";
            document.getElementById('contactError').textContent = "";

            const nameValid = validateuname();
            const passwordValid = validatepass();
            const contactValid = validatephone();

            if (!nameValid || !passwordValid || !contactValid) return;

            const data = { user_name, user_password, user_contact };

            try {
                const response = await fetch('http://localhost:5000/api/user/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data),
                });

                const result = await response.json();

                if (response.ok) {
                    localStorage.setItem('user', JSON.stringify(result.user));
                    alert('Registered Successfully');
                    document.getElementById('signupForm').reset();
                    window.location.href = 'index.html';
                } else if (response.status = 401) {
                    alert('Username alreasy exists');
                } else {
                    alert('Unexpected error occured!')
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred. Please try again later.');
            }
        }

        function togglePasswordVisibility() {
            const passwordField = document.getElementById('password');
            const toggleIcon = document.getElementById('togglePasswordIcon');
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordField.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }

        function validateuname() {
            const name = document.getElementById('name').value;
            const nameError = document.getElementById('nameError');
            nameError.textContent = "";
            const usernameRegex = /^[a-zA-Z0-9_\s\.]{3,20}$/;
            if (!usernameRegex.test(name)) {
                nameError.textContent = "Please enter a valid username (3-20 alphanumeric characters).";
                return false;
            }
            return true;
        }

        function validatepass() {
            const password = document.getElementById('password').value;
            const passwordError = document.getElementById('passwordError');
            passwordError.textContent = "";
            const strongPasswordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
            if (!strongPasswordRegex.test(password)) {
                passwordError.textContent = "Password must be at least 8 characters with 1 uppercase, 1 lowercase, 1 digit, and 1 special character.";
                return false;
            }
            return true;
        }

        function validatephone() {
            const contact = document.getElementById('contact').value;
            const contactError = document.getElementById('contactError');
            contactError.textContent = "";
            const pakistaniPhoneNumberRegex = /^(?:\+92|0)?\d{10}$/;
            if (!pakistaniPhoneNumberRegex.test(contact)) {
                contactError.textContent = "Enter a valid Pakistani contact number (e.g., +923001234567 or 03001234567).";
                return false;
            }
            return true;
        }
    </script>
</body>

</html>